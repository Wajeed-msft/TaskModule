@using Microsoft.Teams.Samples.TaskModule.Web.Helper;
<div class="font-semibold font-title">
    This is our first tab
</div>
<p>
    Welcome to Microsoft Teams Hello World sample app (C#)
    <div>
        <button onclick="submit('html');">HTML Page</button>
        <button onclick="submit('adaptivecard');">Adaptive Card</button>
        <button onclick="submit('html completionBotId');">HTML - Send Result to Bot</button>
        <button onclick="submit('adaptivecard completionBotId');">Adaptive Card - Send Result to Bot</button>
        <br />
        <br />
        <a target="_blank" href="https://teams.microsoft.com/l/task/@(ApplicationSettings.MicrosoftAppId)?url=@(ApplicationSettings.BaseUrlEncoded)%2Fcustomform&height=medium&width=medium&title=TaskInfo&completionBotId=@(ApplicationSettings.MicrosoftAppId)">Deep link to HTML Page</a>
    </div>
</p>

<script type="text/javascript">
    microsoftTeams.initialize();

    submitHandler = (err, result) => {
        console.log(`Submit handler - err: ${err}`);
        alert("Result = " + JSON.stringify(result) + "\nError = " + JSON.stringify(err));
        // console.log(`Submit handler - result\rName: ${result.name}\rEmail: ${result.email}\rFavorite book: ${result.favoriteBook}`);
    };

    function submit(type) {

        let taskInfo = {
            title: null,
            height: null,
            width: null,
            url: null,
            card: null,
            fallbackUrl: null,
            completionBotId: null,
        };

        taskInfo.title = "Task Module Demo";
        taskInfo.height = "medium";
        taskInfo.width = "medium";

        var card = {
            contentType: "application/vnd.microsoft.card.adaptive",
            content: getCard()
        }

        if (type.includes('html'))
            taskInfo.url = "@(ApplicationSettings.BaseUrl)" +"/customform";
        else
            taskInfo.card = card;

        if (type.includes('completionBotId'))
            taskInfo.completionBotId = "@(ApplicationSettings.MicrosoftAppId)";

        microsoftTeams.tasks.startTask(taskInfo, submitHandler);
    }

    function getCard() {
        var card = {
            "type": "AdaptiveCard",
            "body": [
                {
                    "type": "Container",
                    "items": [
                        {
                            "type": "TextBlock",
                            "size": "Medium",
                            "weight": "Bolder",
                            "text": "Publish Adaptive Card schema"
                        },
                        {
                            "type": "ColumnSet",
                            "columns": [
                                {
                                    "type": "Column",
                                    "items": [
                                        {
                                            "type": "Image",
                                            "style": "Person",
                                            "url": "https://pbs.twimg.com/profile_images/3647943215/d7f12830b3c17a5a9e4afcc370e3a37e_400x400.jpeg",
                                            "size": "Small"
                                        }
                                    ],
                                    "width": "auto"
                                },
                                {
                                    "type": "Column",
                                    "items": [
                                        {
                                            "type": "TextBlock",
                                            "weight": "Bolder",
                                            "text": "Matt Hidinger",
                                            "wrap": true
                                        },
                                        {
                                            "type": "TextBlock",
                                            "spacing": "None",
                                            "text": "Created {{DATE(2017-02-14T06:08:39Z,SHORT)}}",
                                            "isSubtle": true,
                                            "wrap": true
                                        }
                                    ],
                                    "width": "stretch"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "Container",
                    "items": [
                        {
                            "type": "TextBlock",
                            "text": "Now that we have defined the main rules and features of the format, we need to produce a schema and publish it to GitHub. The schema will be the starting point of our reference documentation.",
                            "wrap": true
                        },
                        {
                            "type": "FactSet",
                            "facts": [
                                {
                                    "title": "Board:",
                                    "value": "Adaptive Card"
                                },
                                {
                                    "title": "List:",
                                    "value": "Backlog"
                                },
                                {
                                    "title": "Assigned to:",
                                    "value": "Matt Hidinger"
                                },
                                {
                                    "title": "Due date:",
                                    "value": "Not set"
                                }
                            ]
                        }
                    ]
                }
            ],
            "actions": [
                {
                    "type": "Action.ShowCard",
                    "title": "Set due date",
                    "card": {
                        "type": "AdaptiveCard",
                        "style": "emphasis",
                        "body": [
                            {
                                "type": "Input.Date",
                                "id": "dueDate"
                            },
                            {
                                "type": "Input.Text",
                                "id": "comment",
                                "placeholder": "Add a comment",
                                "isMultiline": true
                            }
                        ],
                        "actions": [
                            {
                                "type": "Action.Submit",
                                "title": "OK",
                                "data": {
                                    "actester": true
                                }
                            }
                        ]
                    }
                },
                {
                    "type": "Action.OpenUrl",
                    "title": "View",
                    "url": "http://adaptivecards.io"
                }
            ],
            "version": "1.0"
        };
        return card;
    }
</script>

